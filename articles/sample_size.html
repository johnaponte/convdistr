<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="convdistr">
<title>Sample size with Uncertainty • convdistr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample size with Uncertainty">
<meta property="og:description" content="convdistr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">convdistr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/sample_size.html">Sample size with Uncertainty</a>
    <a class="dropdown-item" href="../articles/using-convdistr.html">Using the convdistr package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/johnaponte/convdistr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Sample size with Uncertainty</h1>
                        <h4 data-toc-skip class="author">John
Aponte</h4>
            
            <h4 data-toc-skip class="date">2024-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/johnaponte/convdistr/blob/HEAD/vignettes/sample_size.Rmd" class="external-link"><code>vignettes/sample_size.Rmd</code></a></small>
      <div class="d-none name"><code>sample_size.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This example show in details how to construct a new factory of
<code>DISTRIBUTION</code> objects using a convolution of parameters to
propagate the uncertainty to the final calculation.</p>
<p>The estimation of sample size require the input of different
parameters in a way that when the parameters are correct, the power to
have a significant result is correct. However many times there are some
uncertainty on the parameters and this is not reflected in the
power.</p>
<p>The <code>convdist</code> package could help on explicitly express
uncertainty on those parameters and estimate the distribution of sample
sizes that would satisfy the power requirements of the assay.</p>
<p>We explore how to estimate the sample size for binomial outcome with
uncertainty and explain the details of how to construct a
<code>DISTRIBUTION</code> factory function.</p>
</div>
<div class="section level2">
<h2 id="sample-size-for-a-proportion">Sample size for a proportion<a class="anchor" aria-label="anchor" href="#sample-size-for-a-proportion"></a>
</h2>
<p>For an individually randomized trial, the number of subjects per
group could be defined as <span class="math display">\[n = (z_{\alpha/2}
+ z_\beta)^2 [\pi_0(1 – \pi_0) + \pi_1(1 – \pi1)]/(\pi_0 –
\pi_1)^2\]</span></p>
<p>In this formula, <span class="math inline">\(z_{\alpha/2}\)</span>
and <span class="math inline">\(z_\beta\)</span> are standard normal
distribution values corresponding to upper tail probabilities of <span class="math inline">\(z_{\alpha/2}\)</span> and <span class="math inline">\(z_\beta\)</span> respectively. This choice of
sample size provides a power of 100(1 – <span class="math inline">\(\beta\)</span>)% to obtaining a significant
difference (<span class="math inline">\(P &lt; \alpha\)</span> on a
two-sided test), assuming that the true (population) proportion in
presence or absence of the interventions are <span class="math inline">\(\pi_1\)</span> and <span class="math inline">\(\pi_0\)</span> respectively</p>
<p><span class="math inline">\(\pi_1\)</span> can be express on terms of
<span class="math inline">\(\pi_0\)</span> as <span class="math inline">\(\pi_1 = \pi_0 RR\)</span> where <span class="math inline">\(RR\)</span> is the relative risk.</p>
<p>In the real world, there could be uncertainty on the exact values of
<span class="math inline">\(\pi_0\)</span> and <span class="math inline">\(RR\)</span> as they may come from previous studies
or surveys. What would be the distribution of <span class="math inline">\(n\)</span> if the uncertainty is taking into
account?</p>
</div>
<div class="section level2">
<h2 id="a-new-distribution-factory">A new <code>DISTRIBUTION</code> factory<a class="anchor" aria-label="anchor" href="#a-new-distribution-factory"></a>
</h2>
<p>We can construct a <code>DISTRIBUTION</code> object which would
produce random numbers taking into account the a probability
distribution for <span class="math inline">\(\pi_0\)</span> and <span class="math inline">\(RR\)</span></p>
<p>See the code of <code>new_UNIFORM</code> function as an example of
how is a factory of <code>DISTRIBUTION</code> objects:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/johnaponte/convdistr" class="external-link">convdistr</a></span><span class="op">)</span></span>
<span><span class="va">new_UNIFORM</span></span>
<span><span class="co">#&gt; function (p_min, p_max, p_dimnames = "rvar") </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     stopifnot(p_min &lt;= p_max)</span></span>
<span><span class="co">#&gt;     .oval = (p_max + p_min)/2</span></span>
<span><span class="co">#&gt;     names(.oval) &lt;- p_dimnames</span></span>
<span><span class="co">#&gt;     structure(list(distribution = "UNIFORM", seed = sample(1:2^15, </span></span>
<span><span class="co">#&gt;         1), oval = .oval, rfunc = restrict_environment(function(n) {</span></span>
<span><span class="co">#&gt;         matrix(runif(n, p_min, p_max), ncol = 1, dimnames = list(1:n, </span></span>
<span><span class="co">#&gt;             p_dimnames))</span></span>
<span><span class="co">#&gt;     }, p_min = p_min, p_max = p_max, p_dimnames = p_dimnames)), </span></span>
<span><span class="co">#&gt;         class = c("UNIFORM", "DISTRIBUTION"))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55be59110a48&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:convdistr&gt;</span></span></code></pre></div>
<p>The function should return an structure which consist of a list of
four named vector and a class attribute that should include
“DISTRIBUTION” The components of the list are:</p>
<p><strong>distribution</strong> : A character with the name of the
distribution implemented. It is a good practice to use the same name
also in the class attribute</p>
<p><strong>seed</strong> : A numerical seed that is use to get a
repeatable sample in the <code>summary</code> function Use a
<code>sample</code> function to ensure each new object will have a
different seed</p>
<p><strong>oval</strong> : The observed value. It is the value expected.
It is used as a number for the mathematical operations of the
distributions as if they were a simple scalar</p>
<p><strong>rfunc(n)</strong> : A function that generate random numbers
from the distribution. Its only parameter <code>n</code> is the number
of drawns of the distribution. It returns a matrix with as many rows as
<code>n</code>, and as many columns as the dimensions of the
distributions, The <code>rfunc</code> should be defined within a
<code>restrict_environment</code> function to ensure only the variables
required to the function are included in the environment of the
function. This will prevent <em>reference leaking</em> which could make
the objects big and slow when saved in a file.</p>
<p>The factory of object for the sample size of proportions could be
defined as:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Sample size for proportions, with uncertainty</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' Create an new DISTRIBUTION object that produce</span></span>
<span><span class="co">#' random drawns of the estimated sample size for</span></span>
<span><span class="co">#' two proportions</span></span>
<span><span class="co">#' @param p0 a DISTRIBUTION object that drawns for proportions in control group</span></span>
<span><span class="co">#' @param logrr a DISTRIBUTION object that drawns log(RR) of the intervention</span></span>
<span><span class="co">#' @param alpha significant value</span></span>
<span><span class="co">#' @param beta  1-power</span></span>
<span><span class="va">new_SAMPLE_SIZE</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p0</span>,<span class="va">logrr</span>, <span class="va">alpha</span><span class="op">=</span> <span class="fl">0.05</span>, <span class="va">beta</span><span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#checkings</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">p0</span>,<span class="st">"DISTRIBUTION"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">logrr</span>,<span class="st">"DISTRIBUTION"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">&lt;</span> <span class="va">alpha</span> <span class="op">&amp;</span> <span class="va">alpha</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">&lt;</span> <span class="va">beta</span> <span class="op">&amp;</span> <span class="va">beta</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span> <span class="co"># function of alpha and beta</span></span>
<span>  <span class="va">f_alpha_beta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">/</span><span class="fl">2</span>,lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">beta</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> </span>
<span>  </span>
<span>  <span class="co"># The expected value of the distribution with default name for the dimension</span></span>
<span>  <span class="co"># based on the oval value of the individual distributions  </span></span>
<span>  <span class="va">v0</span> <span class="op">&lt;-</span> <span class="va">p0</span><span class="op">$</span><span class="va">oval</span></span>
<span>  <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">p0</span><span class="op">$</span><span class="va">oval</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logrr</span><span class="op">$</span><span class="va">oval</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># expected value of the distribution</span></span>
<span>  <span class="va">.oval</span> <span class="op">&lt;-</span> <span class="va">f_alpha_beta</span> <span class="op">*</span> <span class="op">(</span><span class="va">v0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">v0</span><span class="op">)</span> <span class="op">+</span> <span class="va">v1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">v1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">v0</span> <span class="op">-</span> <span class="va">v1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.oval</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"rvar"</span></span>
<span>    </span>
<span>  <span class="co">#random function within a restricted environment where only</span></span>
<span>  <span class="co">#the specified variables can be accesed within the function</span></span>
<span>  <span class="va">.rfunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/restrict_environment.html">restrict_environment</a></span><span class="op">(</span></span>
<span>     <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="va">d_p0</span> <span class="op">=</span> <span class="fu">rfunc_p0</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>       <span class="va">d_p1</span> <span class="op">=</span> <span class="va">d_p0</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu">rfunc_logrr</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>       <span class="va">fab</span> <span class="op">*</span> <span class="op">(</span><span class="va">d_p0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">d_p0</span><span class="op">)</span> <span class="op">+</span> <span class="va">d_p1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">d_p1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">d_p0</span> <span class="op">-</span> <span class="va">d_p1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span>     <span class="op">}</span>,</span>
<span>     rfunc_p0 <span class="op">=</span> <span class="va">p0</span><span class="op">$</span><span class="va">rfunc</span>,</span>
<span>     rfunc_logrr <span class="op">=</span> <span class="va">logrr</span><span class="op">$</span><span class="va">rfunc</span>,</span>
<span>     fab <span class="op">=</span> <span class="va">f_alpha_beta</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Create the object with 4 slots</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      distribution <span class="op">=</span> <span class="st">"SAMPLE_SIZE"</span>,</span>
<span>      seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span> <span class="op">^</span> <span class="fl">15</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      oval <span class="op">=</span> <span class="va">.oval</span>,</span>
<span>      rfunc <span class="op">=</span> <span class="va">.rfunc</span></span>
<span>    <span class="op">)</span>, </span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SAMPLE_SIZE"</span>,<span class="st">"DISTRIBUTION"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-the-sample-size-object">Using the Sample Size object<a class="anchor" aria-label="anchor" href="#using-the-sample-size-object"></a>
</h2>
<p>As example, suppose that the incidence of anaemia in children under 5
have been estimated from a survey as 35% with 95%CI (30%,40%), and a
prevention treatment that in other settings have shown to decrease
anaemia by 50% with 95%CI(8% to 73%).</p>
<p>We can define a <code>BETA</code> distribution based on the CI as</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_p0</span> <span class="op">=</span> <span class="fu"><a href="../reference/BETA.html">new_BETA_lci</a></span><span class="op">(</span><span class="fl">0.35</span>,<span class="fl">0.30</span>,<span class="fl">0.40</span><span class="op">)</span></span></code></pre></div>
<p>And a <code>NORMAL</code> distribution of the <code>log(RR)</code>
as</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">50</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">sd</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">8</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">73</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span></span>
<span><span class="va">d_logrr</span> <span class="op">=</span> <span class="fu"><a href="../reference/NORMAL.html">new_NORMAL</a></span><span class="op">(</span><span class="va">rr</span>,<span class="va">sd</span><span class="op">)</span></span></code></pre></div>
<p>So the input distributions are</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="12%">
<col width="9%">
<col width="12%">
<col width="9%">
<col width="7%">
<col width="7%">
<col width="12%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">distribution</th>
<th align="left">varname</th>
<th align="right">oval</th>
<th align="right">nsample</th>
<th align="right">mean_</th>
<th align="right">sd_</th>
<th align="right">lci_</th>
<th align="right">median_</th>
<th align="right">uci_</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BETA</td>
<td align="left">rvar</td>
<td align="right">0.35</td>
<td align="right">10000</td>
<td align="right">0.35</td>
<td align="right">0.02</td>
<td align="right">0.3</td>
<td align="right">0.35</td>
<td align="right">0.4</td>
</tr>
<tr class="even">
<td align="left">NORMAL</td>
<td align="left">rvar</td>
<td align="right">-0.69</td>
<td align="right">10000</td>
<td align="right">-0.70</td>
<td align="right">0.31</td>
<td align="right">-1.3</td>
<td align="right">-0.70</td>
<td align="right">-0.1</td>
</tr>
</tbody>
</table>
<p>And base on this we can calculate the distribution of samples with
those conditions</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_sample</span> <span class="op">&lt;-</span> <span class="fu">new_SAMPLE_SIZE</span><span class="op">(</span><span class="va">d_p0</span>, <span class="va">d_logrr</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="19%">
<col width="12%">
<col width="7%">
<col width="12%">
<col width="9%">
<col width="12%">
<col width="7%">
<col width="12%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">distribution</th>
<th align="left">varname</th>
<th align="right">oval</th>
<th align="right">nsample</th>
<th align="right">mean_</th>
<th align="right">sd_</th>
<th align="right">lci_</th>
<th align="right">median_</th>
<th align="right">uci_</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">SAMPLE_SIZE</td>
<td align="left">rvar</td>
<td align="right">95</td>
<td align="right">10000</td>
<td align="right">25347</td>
<td align="right">1189403</td>
<td align="right">38</td>
<td align="right">96</td>
<td align="right">2350</td>
</tr></tbody>
</table>
<p><img src="sample_size_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>The oval value of the distribution give us the result we obtain from
the formula. With the conditions specified, a sample size of
<code>95</code> is required. However, the distribution is quite skewed
as you can see the mean and the median value are far, and the standard
deviation very big. This is because the sample size require for
combinations of low efficacy and low prevalence could be very large and
there is no restriction on how low could be the efficacy or the
prevalence, which although have low frequency, could happen in the
simulations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rdrawn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfunc.html">rfunc</a></span><span class="op">(</span><span class="va">d_sample</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">f_ecdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">rdrawn</span><span class="op">)</span></span>
<span><span class="va">n_80</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">trunc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html" class="external-link">uniroot</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu">f_ecdf</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.8</span><span class="op">}</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10000</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">root</span><span class="op">)</span></span></code></pre></div>
<p>The empirical cumulative distribution values of a random sample of
the distribution show us that with <code>209</code> subjects per arm,
80% of the possible scenarios are covered</p>
<p><img src="sample_size_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="enhance-the-sample-size-object">Enhance the Sample Size object<a class="anchor" aria-label="anchor" href="#enhance-the-sample-size-object"></a>
</h2>
<p>The function created above show us a distribution of sample size, but
we can’t inspect condition on which a particular drawn is obtained,
<em>i.e.</em> how low an prevalent anaemia value could be compensated
with a high efficacy value? To do that we could create a second object
that have drawns in several dimensions, the prevalence, the RR and the
sample size so we can make a graph with the three values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Sample size for proportions, with uncertainty (V2)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' Create an new DISTRIBUTION object that produce</span></span>
<span><span class="co">#' random drawns of the estimated sample size for</span></span>
<span><span class="co">#' two proportions as well as the samples from the parameters</span></span>
<span><span class="co">#' @param p0 a DISTRIBUTION object that drawns for proportions in control group</span></span>
<span><span class="co">#' @param logrr a DISTRIBUTION object that drawns log(RR) of the intervention</span></span>
<span><span class="co">#' @param alpha significant value</span></span>
<span><span class="co">#' @param beta  1-power</span></span>
<span><span class="va">new_SAMPLE_SIZE2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p0</span>,<span class="va">logrr</span>, <span class="va">alpha</span><span class="op">=</span> <span class="fl">0.05</span>, <span class="va">beta</span><span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#checkings</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">p0</span>,<span class="st">"DISTRIBUTION"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">logrr</span>,<span class="st">"DISTRIBUTION"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">&lt;</span> <span class="va">alpha</span> <span class="op">&amp;</span> <span class="va">alpha</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">&lt;</span> <span class="va">beta</span> <span class="op">&amp;</span> <span class="va">beta</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span> <span class="co"># function of alpha and beta</span></span>
<span>  <span class="va">f_alpha_beta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">/</span><span class="fl">2</span>,lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">beta</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> </span>
<span>  </span>
<span>  <span class="co"># The expected value of the distribution with default name for the dimension</span></span>
<span>  <span class="co"># based on the oval value of the individual distributions  </span></span>
<span>  <span class="va">v0</span> <span class="op">&lt;-</span> <span class="va">p0</span><span class="op">$</span><span class="va">oval</span></span>
<span>  <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">p0</span><span class="op">$</span><span class="va">oval</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logrr</span><span class="op">$</span><span class="va">oval</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># expected value of the distribution</span></span>
<span>  <span class="va">ss</span> <span class="op">&lt;-</span> <span class="va">f_alpha_beta</span> <span class="op">*</span> <span class="op">(</span><span class="va">v0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">v0</span><span class="op">)</span> <span class="op">+</span> <span class="va">v1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">v1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">v0</span> <span class="op">-</span> <span class="va">v1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span>  <span class="va">.oval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p0</span><span class="op">$</span><span class="va">oval</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logrr</span><span class="op">$</span><span class="va">oval</span><span class="op">)</span>, <span class="va">ss</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.oval</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'prevalence'</span>, <span class="st">'rr'</span>, <span class="st">'sample_size'</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="co">#random function within a restricted environment where only</span></span>
<span>  <span class="co">#the specified variables can be accesed within the function</span></span>
<span>  <span class="va">.rfunc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/restrict_environment.html">restrict_environment</a></span><span class="op">(</span></span>
<span>     <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="va">d_p0</span> <span class="op">=</span> <span class="fu">rfunc_p0</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>       <span class="va">d_rr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu">rfunc_logrr</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>       <span class="va">d_p1</span> <span class="op">=</span> <span class="va">d_p0</span> <span class="op">*</span> <span class="va">d_rr</span></span>
<span>       <span class="va">d_ss</span> <span class="op">=</span> <span class="va">fab</span> <span class="op">*</span> <span class="op">(</span><span class="va">d_p0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">d_p0</span><span class="op">)</span> <span class="op">+</span> <span class="va">d_p1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">d_p1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">d_p0</span> <span class="op">-</span> <span class="va">d_p1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d_p0</span>, <span class="va">d_rr</span>, <span class="va">d_ss</span><span class="op">)</span>, </span>
<span>         ncol <span class="op">=</span> <span class="fl">3</span>, </span>
<span>         dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'prevalence'</span>,<span class="st">'rr'</span>,<span class="st">'sample_size'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span>,</span>
<span>     rfunc_p0 <span class="op">=</span> <span class="va">p0</span><span class="op">$</span><span class="va">rfunc</span>,</span>
<span>     rfunc_logrr <span class="op">=</span> <span class="va">logrr</span><span class="op">$</span><span class="va">rfunc</span>,</span>
<span>     fab <span class="op">=</span> <span class="va">f_alpha_beta</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># Create the object with 4 slots</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      distribution <span class="op">=</span> <span class="st">"SAMPLE_SIZE2"</span>,</span>
<span>      seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span> <span class="op">^</span> <span class="fl">15</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      oval <span class="op">=</span> <span class="va">.oval</span>,</span>
<span>      rfunc <span class="op">=</span> <span class="va">.rfunc</span></span>
<span>    <span class="op">)</span>, </span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SAMPLE_SIZE2"</span>,<span class="st">"DISTRIBUTION"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_sample2</span> <span class="op">&lt;-</span> <span class="fu">new_SAMPLE_SIZE2</span><span class="op">(</span><span class="va">d_p0</span>, <span class="va">d_logrr</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="15%">
<col width="7%">
<col width="10%">
<col width="10%">
<col width="12%">
<col width="7%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">distribution</th>
<th align="left">varname</th>
<th align="right">oval</th>
<th align="right">nsample</th>
<th align="right">mean_</th>
<th align="right">sd_</th>
<th align="right">lci_</th>
<th align="right">median_</th>
<th align="right">uci_</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">SAMPLE_SIZE2</td>
<td align="left">prevalence</td>
<td align="right">0.35</td>
<td align="right">10000</td>
<td align="right">0.35</td>
<td align="right">0.02</td>
<td align="right">0.30</td>
<td align="right">0.35</td>
<td align="right">0.40</td>
</tr>
<tr class="even">
<td align="left">SAMPLE_SIZE2</td>
<td align="left">rr</td>
<td align="right">0.50</td>
<td align="right">10000</td>
<td align="right">0.53</td>
<td align="right">0.17</td>
<td align="right">0.28</td>
<td align="right">0.50</td>
<td align="right">0.92</td>
</tr>
<tr class="odd">
<td align="left">SAMPLE_SIZE2</td>
<td align="left">sample_size</td>
<td align="right">95.31</td>
<td align="right">10000</td>
<td align="right">6908.79</td>
<td align="right">221869.02</td>
<td align="right">38.32</td>
<td align="right">95.89</td>
<td align="right">2605.02</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfunc.html">rfunc</a></span><span class="op">(</span><span class="va">d_sample2</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">ss</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">category</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">sample_size</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span>,<span class="cn">Inf</span><span class="op">)</span>,include.lowest <span class="op">=</span> <span class="cn">T</span>, ordered_result <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   prevalence        rr sample_size  category</span></span>
<span><span class="co">#&gt; 1  0.3459163 0.5151837   104.01165   [0,150]</span></span>
<span><span class="co">#&gt; 2  0.3290356 0.6687854   259.31858 (150,Inf]</span></span>
<span><span class="co">#&gt; 3  0.3074351 0.6707793   288.55029 (150,Inf]</span></span>
<span><span class="co">#&gt; 4  0.3563093 0.4462713    73.20836   [0,150]</span></span>
<span><span class="co">#&gt; 5  0.3382727 0.2707446    39.60154   [0,150]</span></span>
<span><span class="co">#&gt; 6  0.3602419 0.4146032    63.09802   [0,150]</span></span></code></pre></div>
<p>The following graph shows the combination of options that would lead
to a sample size lower than 150 subjects</p>
<p><img src="sample_size_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>We see that under this particular set of conditions, it is possible
to have more than 80% power in all prevalence range provided the
relative risk is really lower than 50%.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Aponte John.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
